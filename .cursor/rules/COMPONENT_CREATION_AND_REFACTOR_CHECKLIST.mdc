---
alwaysApply: true
title: Component Creation & Refactor Checklist
version: 1.0
status: Active
owner: Cursor AI
priority: Critical
scope: Component
language: en
last_updated: 2025-12-19
---

# Component Creation & Refactor Checklist (Canonical)

## Purpose

This document defines a **mandatory execution checklist**
for creating NEW components and REFACTORING existing components.

It exists to:
- standardize component quality
- prevent uncontrolled refactors
- ensure full compliance with token-driven architecture
- safely migrate legacy components to canonical form

This checklist is **not advisory**.
All steps are mandatory.

---

## MODE SELECTION (STEP 0)

Before any work begins, the AI MUST explicitly select ONE mode:

- **CREATE** ‚Äî creating a brand-new component
- **REFACTOR** ‚Äî refactoring an existing component
- **BUGFIX** ‚Äî fixing behavior without structural change

If the mode is not explicitly clear, the AI MUST STOP and ASK.

---

# üÜï CREATE MODE ‚Äî New Component

## CREATE-1: Authority & Lock Check

The AI MUST verify:

- The component does NOT exist already
- The component is not listed as LOCKED
- The component is allowed in the current extension layer

References:
- `docs/architecture/EXTENSION_STATE.md`
- `docs/architecture/FOUNDATION_LOCK.md`

If creation violates any lock ‚Üí **REFUSE**.

---

## CREATE-2: Component Classification

The AI MUST classify the component as ONE of:

- Primitive
- Control
- Layout
- Composite
- Utility

Classification MUST match existing project taxonomy.

---

## CREATE-2.5: Component Scaffold Generation

**For Extension components only:** The AI MUST generate component scaffold using the CLI tool before implementation.

The AI MUST:
- Run `pnpm run component:generate -- <ComponentName> [--category <category>]`
- Verify all scaffold files created:
  - `{ComponentName}.tsx` - Main component file
  - `{ComponentName}.stories.tsx` - Storybook stories
  - `{ComponentName}.test.tsx` - Test file
  - `{ComponentName}.index.ts` - Export file
- Verify component placed in correct directory: `src/COMPOSITION/{categoryDir}/{ComponentName}/`
- Review generated scaffold structure

**Note:** The scaffold generator (`scripts/generate-extension-component.ts`) automatically:
- Validates component name (PascalCase, not Foundation duplicate)
- Determines correct directory based on category
- Creates all required files with proper structure
- Includes TODO comments and compliance notes

**Usage examples:**
```bash
# Default (composite category ‚Üí overlays/)
pnpm run component:generate -- ConfirmDialog

# With category
pnpm run component:generate -- HeroSection --category layout
```

**Reference:** See `docs/workflows/tasks/COMPONENT_CREATION_CHECKLIST.md` for complete checklist.

---

## CREATE-3: Token Mapping (MANDATORY)

Before writing code, the AI MUST:

- List all visual and behavioral props
- Map EACH prop to an existing token domain
- Use **token unions only**
- Use `Responsive<T>` where applicable

The AI MUST NOT:
- Use raw values
- Create new tokens
- Extend token scales

If a required token does not exist ‚Üí **STOP and REQUEST NEW TASK**.

---

## CREATE-4: API Design Constraints

The AI MUST ensure:

- Public props are minimal and explicit
- No boolean style toggles without token backing
- No `variant: "primary" | "secondary"` patterns
- Types are exported explicitly
- **For Foundation components:** `className` and `style` props MUST be excluded from public API (Foundation Enforcement is FINAL/APPLIED)
- **For Foundation components:** MUST use `Omit<React.*HTMLAttributes, "className" | "style">` pattern

---

## CREATE-5: Implementation

The AI MUST:

- Follow architecture rules
- Modify ONLY files required for the component
- Export types and component explicitly
- Avoid wildcard exports

---

## CREATE-6: Verification

Before completion, the AI MUST verify:

- No raw values exist
- All props map to tokens
- Scope is limited to this component
- No unrelated files were touched
- **For Foundation components:** Foundation Enforcement compliance verified (className/style excluded, ESLint rules pass, type-tests pass)

If verification fails ‚Üí **FIX or REFUSE**.

---

# ‚ôªÔ∏è REFACTOR MODE ‚Äî Existing Component

## REFACTOR-1: Refactor Legitimacy Check

The AI MUST verify that:

- Refactor is explicitly requested
- Target component is NOT locked
- Scope is limited to ONE component

If refactor legitimacy is unclear ‚Üí **STOP and ASK**.

---

## REFACTOR-2: Baseline Preservation

The AI MUST:

- Preserve existing behavior unless change is explicitly requested
- Treat visual parity as mandatory
- Avoid API changes unless explicitly requested

Breaking changes are forbidden by default.

---

## REFACTOR-3: Token Migration

The AI MUST:

- Replace raw values with token-backed values
- Replace legacy enums with token unions
- Align props with current token domains

The AI MUST NOT:
- Introduce new tokens
- Modify token scales
- Collapse or merge domains

---

## REFACTOR-4: Structural Discipline

The AI MUST:

- Keep file structure unless change is requested
- Avoid renaming exports
- Avoid moving files

Refactor ‚â† rewrite.

---

## REFACTOR-5: Scope Guard

The AI MUST NOT:

- Refactor adjacent components
- Touch shared utilities
- Perform opportunistic cleanups

If refactor requires touching another component ‚Üí **REFUSE**.

---

## REFACTOR-6: Verification

Before completion, the AI MUST verify:

- Behavior parity
- Token compliance
- No scope leakage
- No hidden API changes
- **For Foundation components:** Foundation Enforcement compliance maintained (className/style remain excluded, ESLint rules pass, type-tests pass)

If verification fails ‚Üí **FIX or REFUSE**.

---

# üõ† BUGFIX MODE ‚Äî Limited Fix

## BUGFIX-1: Scope Limitation

The AI MUST:

- Fix ONLY the reported bug
- Avoid structural changes
- Avoid refactors

If bugfix requires refactor ‚Üí **STOP and REQUEST MODE CHANGE**.

---

# üö´ GLOBAL PROHIBITIONS

In ALL modes, the AI MUST NOT:

- Introduce new tokens
- Change Authority or Locks
- Modify multiple components
- Apply patterns from other projects
- **For Foundation components:** Add `className` or `style` props to public API (Foundation Enforcement is FINAL/APPLIED and LOCKED)
- **For Foundation components:** Extend `React.*HTMLAttributes` directly without `Omit<..., "className" | "style">`

---

## Final Enforcement Rule

This checklist is mandatory.

Skipping any step is forbidden.

If any step cannot be completed safely,
the AI MUST STOP and ASK or REFUSE.

