---
alwaysApply: true
title: Component Creation & Refactor Checklist
version: 2.0
status: Active
owner: Cursor AI
priority: Critical
scope: Component
language: en
last_updated: 2025-12-19
---

# Component Creation & Refactor Checklist (Canonical)

## Purpose

This document defines a **mandatory execution checklist**
for creating NEW components and REFACTORING existing components.

It exists to:
- standardize component quality
- prevent uncontrolled refactors
- ensure full compliance with token-driven architecture
- safely migrate legacy components to canonical form

This checklist is **not advisory**.
All steps are mandatory.

---

## MODE SELECTION (STEP 0)

Before any work begins, the AI MUST explicitly select ONE mode:

- **CREATE** ‚Äî creating a brand-new component
- **REFACTOR** ‚Äî refactoring an existing component
- **BUGFIX** ‚Äî fixing behavior without structural change

If the mode is not explicitly clear, the AI MUST STOP and ASK.

---

# üÜï CREATE MODE ‚Äî New Component

> **Canonical Reference:** For component creation lifecycle protocol, see [component-lifecycle.mdc](../.cursor/rules/component-lifecycle.mdc). This checklist provides detailed execution steps; the lifecycle protocol defines the mandatory algorithm for creating components.

## CREATE-1: Authority & Lock Check

The AI MUST verify:

- The component does NOT exist already
- The component is not listed as LOCKED
- The component is allowed in the current extension layer

References:
- `docs/architecture/EXTENSION_STATE.md`
- `docs/architecture/FOUNDATION_LOCK.md`

If creation violates any lock ‚Üí **REFUSE**.

---

## CREATE-2: Component Classification

The AI MUST classify the component as ONE of:

- Primitive
- Control
- Layout
- Composite
- Utility

Classification MUST match existing project taxonomy.

---

## CREATE-2.5: Component Scaffold Generation

**For Extension components only:** The AI MUST generate component scaffold using the CLI tool before implementation.

The AI MUST:
- Run `pnpm run component:generate -- <ComponentName> [--category <category>]`
- Verify all scaffold files created:
  - `{ComponentName}.tsx` - Main component file
  - `{ComponentName}.stories.tsx` - Storybook stories
  - `{ComponentName}.test.tsx` - Test file
  - `{ComponentName}.index.ts` - Export file
- Verify component placed in correct directory: `src/COMPOSITION/{categoryDir}/{ComponentName}/`
- Review generated scaffold structure

**Note:** The scaffold generator (`scripts/generate-extension-component.ts`) automatically:
- Validates component name (PascalCase, not Foundation duplicate)
- Determines correct directory based on category
- Creates all required files with proper structure
- Includes TODO comments and compliance notes

**Usage examples:**
```bash
# Default (composite category ‚Üí overlays/)
pnpm run component:generate -- ConfirmDialog

# With category
pnpm run component:generate -- HeroSection --category layout
```

**Reference:** See `docs/workflows/tasks/COMPONENT_CREATION_CHECKLIST.md` for complete checklist.

---

## CREATE-3: Token Mapping (MANDATORY)

Before writing code, the AI MUST:

- List all visual and behavioral props
- Map EACH prop to an existing token domain
- Use **token unions only**
- Use `Responsive<T>` where applicable

The AI MUST NOT:
- Use raw values
- Create new tokens
- Extend token scales

If a required token does not exist ‚Üí **STOP and REQUEST NEW TASK**.

---

## CREATE-4: API Design Constraints

The AI MUST ensure:

- Public props are minimal and explicit
- No boolean style toggles without token backing
- No `variant: "primary" | "secondary"` patterns
- Types are exported explicitly
- **For Foundation components:** `className` and `style` props MUST be excluded from public API (Foundation Enforcement is FINAL/APPLIED)
- **For Foundation components:** MUST use `Omit<React.*HTMLAttributes, "className" | "style">` pattern

---

## CREATE-5: Implementation

The AI MUST:

- Follow architecture rules
- Modify ONLY files required for the component
- Export types and component explicitly
- Avoid wildcard exports

---

## CREATE-6: Verification

Before completion, the AI MUST verify:

- No raw values exist
- All props map to tokens
- Scope is limited to this component
- No unrelated files were touched
- **For Foundation components:** Foundation Enforcement compliance verified (className/style excluded, ESLint rules pass, type-tests pass)

If verification fails ‚Üí **FIX or REFUSE**.

---

# ‚ôªÔ∏è REFACTOR MODE ‚Äî Existing Component

> **‚ö†Ô∏è CRITICAL:** Refactoring existing components **MUST** follow the [Component Review & Improvement Pipeline (18A)](../../docs/workflows/foundation/FOUNDATION_STEP_PIPELINE.md). This is the **ONLY** canonical process for refactoring components. The pipeline defines a mandatory 12-step process (STEP 0-11) that **MUST** be executed in order, without reordering.

## REFACTOR-1: Pipeline Mandate Check

The AI MUST verify that:

- Refactor is explicitly requested
- Target component is NOT locked (check `docs/architecture/FOUNDATION_LOCK.md` and `docs/architecture/ARCHITECTURE_LOCK.md`)
- Scope is limited to ONE component
- The AI understands that **pipeline 18A is MANDATORY** for all refactoring work

If refactor legitimacy is unclear ‚Üí **STOP and ASK**.

If component is locked ‚Üí **REFUSE immediately**.

---

## REFACTOR-2: Pipeline Execution Requirements

**The AI MUST execute pipeline 18A (STEP 0-11) in strict order:**

### Mandatory Pipeline Structure:

1. **STEP 0 ‚Äî Baseline Snapshot & Context Fixation**
   - Create audit report at: `docs/reports/audit/<COMPONENT>_BASELINE_REPORT.md`
   - Record current state (files, exports, dependencies, public props)
   - **NO code changes allowed in STEP 0**

2. **STEP 1 ‚Äî Structural & Code Quality Review**
   - Allowed: readability refactors, extracting helpers, mapping duplicates
   - Forbidden: behavior changes, API changes
   - Must update audit report STEP 1 section

3. **STEP 2 ‚Äî Semantic Role & Responsibility Validation**
   - Define 1-2 sentence role definition
   - Identify out-of-scope logic
   - Must update audit report STEP 2 section

4. **STEP 3 ‚Äî Duplication & Internal Pattern Alignment**
   - Align with nearest canonical patterns
   - Forbidden: inventing new patterns
   - Must update audit report STEP 3 section

5. **STEP 4 ‚Äî State & Interaction Model Review**
   - Derived state via data-attributes/CSS where possible
   - Minimal JS state
   - Must update audit report STEP 4 section

6. **STEP 5 ‚Äî Token, Size & Variant Consistency**
   - Token-only styling (no raw values)
   - Size usage aligned with shared size scale
   - Reference: [VARIANTS_SIZE_CANON.md](../../docs/architecture/VARIANTS_SIZE_CANON.md), [SIZE_MAPPING_SPEC.md](../../docs/architecture/SIZE_MAPPING_SPEC.md)
   - Must update audit report STEP 5 section

7. **STEP 6 ‚Äî Public API & DX Review**
   - Remove confusing props
   - Enforce safe defaults
   - Must update audit report STEP 6 section

8. **STEP 7 ‚Äî Type System Alignment**
   - Explicit unions instead of wide types
   - No leaking of internal variant machinery
   - Must update audit report STEP 7 section

9. **STEP 8 ‚Äî Intentional Refactor Pass**
   - Explicit decision: `Refactor required` OR `Refactor not required`
   - Record consciously NOT made changes
   - **MANDATORY checkpoint:** Must share audit report before proceeding
   - Must update audit report STEP 8 section

10. **STEP 9 ‚Äî Validation via Tests & Storybook**
    - Tests cover public behavior and edge cases
    - Storybook demonstrates matrix (variants √ó sizes), states, realistic usage
    - Reference: [VARIANTS_SIZE_CANON.md](../../docs/architecture/VARIANTS_SIZE_CANON.md) for Matrix/States rules
    - **MANDATORY checkpoint:** Must share audit report before proceeding
    - Must update audit report STEP 9 section

11. **STEP 10 ‚Äî Accessibility Audit & Fixes (MANDATORY)**
    - ARIA roles and attributes
    - Keyboard navigation and focus management
    - Screen reader announcement behavior
    - Accessibility-specific tests and Storybook stories
    - **MANDATORY checkpoint:** Must share audit report before proceeding
    - Must update audit report STEP 10 section

12. **STEP 11 ‚Äî Final Review & Outcome Fixation + Architectural Lock**
    - Verify all previous steps complete
    - Lock propagation to: `docs/architecture/FOUNDATION_LOCK.md`, `docs/architecture/ARCHITECTURE_LOCK.md`, `docs/PROJECT_PROGRESS.md`
    - **MANDATORY checkpoint:** Must share audit report before proceeding
    - Must update audit report STEP 11 section

---

## REFACTOR-3: Mandatory Process Requirements

### 4-Phase Step Invariant (NON-NEGOTIABLE)

**Every STEP must complete ALL four phases:**

1. **Observe** ‚Üí collect evidence (paths, exports, current API, current behavior)
2. **Decide** ‚Üí write a decision (what we change / what we do NOT change)
3. **Change** ‚Üí apply scoped refactor (only if allowed in this step)
4. **Record** ‚Üí update the audit report with blockers / non-blockers

If any phase is missing ‚Üí the step is **FAILED** even if code "looks fine".

### Audit Report Requirements

**The AI MUST:**

- Create audit report in STEP 0 at canonical path: `docs/reports/audit/<COMPONENT>_BASELINE_REPORT.md`
- Update audit report after EVERY step (STEP 0-11)
- Each STEP section must include:
  - `Outcome:` one of `No changes required | Changes applied | Changes required (not yet applied)`
  - `Blocking:` `yes/no` (with reason if `yes`)
  - `Notes:` 1-5 bullet points max
  - `Changes:` list of actual changes (or `None`)
  - `Deferred:` list of deferred items (or `None`)
- If a step results in no changes, report must explicitly state: `No changes required in this step`
- Cannot proceed to STEP N+1 unless STEP N is present in report (even if it contains `No changes required`)

### Checkpoint Requirements

**The AI MUST request operator to share audit report at:**

- **Mandatory checkpoints:** STEP 0, STEP 8, STEP 9, STEP 10, STEP 11
- **Recommended checkpoints:** STEP 6, STEP 7
- Cannot proceed past mandatory checkpoint without shared report

### Vocabulary Guardrails

**The AI MUST NOT use these words in STEP 0-10 (only allowed in STEP 11):**

- `final`, `optimal`, `exemplary`, `canonical`, `locked`, `foundation-ready`

**Allowed phrasing in STEP 0-10:**

- `No issues detected in this step`
- `Compliant at this stage`
- `No changes required in this step`
- `Behavior unchanged`

---

## REFACTOR-4: Scope & Constraint Rules

### Scope Enforcement

The AI MUST ensure:

- One task = one component
- No cross-component refactors
- No hidden or indirect changes
- Changes limited to declared scope

### Global Prohibitions

The AI MUST NOT:

- Introduce new tokens
- Change Authority or Locks (unless in STEP 11 with explicit permission)
- Modify multiple components
- Apply patterns from other projects
- Skip pipeline steps or reorder them
- Proceed without updating audit report
- **For Foundation components:** Add `className` or `style` props to public API
- **For Foundation components:** Extend `React.*HTMLAttributes` directly without `Omit<..., "className" | "style">`

### Behavior Preservation

- Behavior must not change unless explicitly allowed
- Visual parity is mandatory unless change is requested
- Public API changes must be deliberate and documented
- Breaking changes are forbidden by default

---

## REFACTOR-5: Completion Verification

**A refactor is considered complete ONLY when:**

- ‚úÖ Audit report has STEP 0-11 filled (all sections present)
- ‚úÖ All mandatory checkpoints passed (report shared at STEP 0, 8, 9, 10, 11)
- ‚úÖ All 4-phase process completed for each step (Observe ‚Üí Decide ‚Üí Change ‚Üí Record)
- ‚úÖ Storybook coverage is not placeholder (matrix + states demonstrated)
- ‚úÖ Tests cover behavior and edge cases
- ‚úÖ A11Y step executed (STEP 10)
- ‚úÖ Lock propagation completed (STEP 11) if component is Foundation
- ‚úÖ No vocabulary violations (no `final`/`optimal`/`canonical` before STEP 11)

If any requirement is missing ‚Üí **REFACTOR IS INCOMPLETE**.

---

# üõ† BUGFIX MODE ‚Äî Limited Fix

## BUGFIX-1: Scope Limitation

The AI MUST:

- Fix ONLY the reported bug
- Avoid structural changes
- Avoid refactors

If bugfix requires refactor ‚Üí **STOP and REQUEST MODE CHANGE**.

---

# üö´ GLOBAL PROHIBITIONS

In ALL modes, the AI MUST NOT:

- Introduce new tokens
- Change Authority or Locks
- Modify multiple components
- Apply patterns from other projects
- **For Foundation components:** Add `className` or `style` props to public API (Foundation Enforcement is FINAL/APPLIED and LOCKED)
- **For Foundation components:** Extend `React.*HTMLAttributes` directly without `Omit<..., "className" | "style">`

---

## Final Enforcement Rule

This checklist is mandatory.

Skipping any step is forbidden.

If any step cannot be completed safely,
the AI MUST STOP and ASK or REFUSE.

