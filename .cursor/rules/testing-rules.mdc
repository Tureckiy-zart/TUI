---
alwaysApply: true
title: Testing Rules for UI Library
version: 1.0
status: Active
owner: Cursor AI
last_updated: TODO:DATE_CONFIRMATION
---

# üß™ Testing Rules for UI Library

This rule file defines standards for testing UI library components, including unit tests, snapshot tests, accessibility tests, and visual regression tests.

---

## üìã Part 1: Testing Framework

### Testing Stack

**ALWAYS** use this testing stack:

- **Framework**: Vitest or Jest
- **Testing Library**: React Testing Library
- **Accessibility**: @testing-library/jest-dom, jest-axe
- **Visual Regression**: Chromatic or Percy (optional)
- **Coverage**: @vitest/coverage-v8 or jest coverage

### Test File Organization

**ALWAYS** organize tests like this:

```
src/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ Button/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Button.test.tsx      # Component tests
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Button.snapshot.test.tsx  # Snapshot tests (optional)
```

---

## üß™ Part 2: Unit Tests

### Test Structure

**ALWAYS** use this structure:

```typescript
import { render, screen, fireEvent } from '@testing-library/react';
import { describe, it, expect, vi } from 'vitest';
import { Button } from './Button';

describe('Button', () => {
  it('renders correctly', () => {
    render(<Button>Click me</Button>);
    expect(screen.getByRole('button', { name: /click me/i })).toBeInTheDocument();
  });

  it('handles click events', () => {
    const handleClick = vi.fn();
    render(<Button onClick={handleClick}>Click me</Button>);

    fireEvent.click(screen.getByRole('button'));
    expect(handleClick).toHaveBeenCalledTimes(1);
  });

  it('applies variant classes', () => {
    const { container } = render(<Button variant="primary">Button</Button>);
    expect(container.firstChild).toHaveClass('button--primary');
  });
});
```

### Test Requirements

**ALWAYS** test:

- Component rendering
- Props handling
- User interactions (click, hover, focus)
- Event handlers
- Conditional rendering
- Edge cases (null, undefined, empty)

---

## üì∏ Part 3: Snapshot Tests

### Snapshot Test Structure

**ALWAYS** create snapshot tests for stable components:

```typescript
import { render } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { Button } from './Button';

describe('Button Snapshot', () => {
  it('matches snapshot for primary variant', () => {
    const { container } = render(<Button variant="primary">Button</Button>);
    expect(container.firstChild).toMatchSnapshot();
  });
});
```

### Snapshot Rules

- **ALWAYS** update snapshots when UI changes intentionally
- **ALWAYS** review snapshot changes in PR
- **NEVER** commit failing snapshots
- **NEVER** use snapshots for frequently changing components

---

## ‚ôø Part 4: Accessibility Tests

### Accessibility Test Structure

**ALWAYS** test accessibility:

```typescript
import { render } from '@testing-library/react';
import { axe, toHaveNoViolations } from 'jest-axe';
import { Button } from './Button';

expect.extend(toHaveNoViolations);

describe('Button Accessibility', () => {
  it('has no accessibility violations', async () => {
    const { container } = render(<Button>Button</Button>);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });

  it('is keyboard accessible', () => {
    render(<Button>Button</Button>);
    const button = screen.getByRole('button');
    expect(button).toHaveAttribute('tabIndex', '0');
  });
});
```

### Accessibility Checklist

- [ ] No a11y violations (axe)
- [ ] Keyboard navigation works
- [ ] ARIA attributes present
- [ ] Focus indicators visible
- [ ] Screen reader tested
- [ ] Color contrast compliant

---

## üé® Part 5: Visual Regression Tests

### Visual Regression Setup

**ALWAYS** use Chromatic or Percy for visual regression:

```typescript
// Button.visual.test.tsx
import { composeStories } from '@storybook/react';
import * as stories from './Button.stories';

const { Primary, Secondary } = composeStories(stories);

describe('Button Visual Regression', () => {
  it('matches visual snapshot for Primary', () => {
    render(<Primary />);
    // Visual snapshot captured by Chromatic
  });
});
```

### Visual Regression Rules

- **ALWAYS** test all variants visually
- **ALWAYS** test responsive breakpoints
- **ALWAYS** review visual changes in PR
- **NEVER** skip visual regression for UI changes

---

## üìä Part 6: Test Coverage

### Coverage Requirements

**ALWAYS** maintain minimum coverage:

- **Statements**: 80%+
- **Branches**: 75%+
- **Functions**: 80%+
- **Lines**: 80%+

### Coverage Configuration

```typescript
// vitest.config.ts
export default {
  test: {
    coverage: {
      thresholds: {
        statements: 80,
        branches: 75,
        functions: 80,
        lines: 80,
      },
    },
  },
};
```

---

## üîß Part 7: Test Utilities

### Custom Render Function

**ALWAYS** create custom render with providers:

```typescript
// test-utils.tsx
import { render } from '@testing-library/react';
import { ThemeProvider } from './ThemeProvider';

export const renderWithProviders = (ui: React.ReactElement) => {
  return render(<ThemeProvider>{ui}</ThemeProvider>);
};
```

### Test Helpers

**ALWAYS** create reusable test helpers:

```typescript
// test-helpers.ts
export const createMockProps = (overrides = {}) => ({
  variant: "primary",
  children: "Button",
  ...overrides,
});
```

---

## üö´ What NOT to Do

- ‚ùå **NEVER** skip tests for components
- ‚ùå **NEVER** test implementation details
- ‚ùå **NEVER** use `getByTestId` (prefer roles)
- ‚ùå **NEVER** skip accessibility tests
- ‚ùå **NEVER** commit failing tests
- ‚ùå **NEVER** skip coverage requirements
- ‚ùå **NEVER** test third-party libraries

---

## ‚úÖ What TO Do

- ‚úÖ **ALWAYS** write tests before implementation (TDD)
- ‚úÖ **ALWAYS** test user interactions, not implementation
- ‚úÖ **ALWAYS** use semantic queries (getByRole, getByLabelText)
- ‚úÖ **ALWAYS** test accessibility
- ‚úÖ **ALWAYS** maintain coverage requirements
- ‚úÖ **ALWAYS** test edge cases
- ‚úÖ **ALWAYS** use descriptive test names

---

## üìã Test Creation Checklist

Before marking tests as complete:

- [ ] Unit tests written for component
- [ ] Props handling tested
- [ ] User interactions tested
- [ ] Edge cases tested
- [ ] Accessibility tests passing
- [ ] Snapshot tests created (if applicable)
- [ ] Visual regression tests passing (if applicable)
- [ ] Coverage meets requirements
- [ ] All tests passing
- [ ] No console warnings/errors

---

## üéØ Test Best Practices

### Test Naming

**ALWAYS** use descriptive test names:

```typescript
// ‚úÖ Good
it('displays error message when validation fails', () => { ... });

// ‚ùå Bad
it('works', () => { ... });
```

### Test Organization

**ALWAYS** group related tests:

```typescript
describe('Button', () => {
  describe('Rendering', () => { ... });
  describe('Interactions', () => { ... });
  describe('Accessibility', () => { ... });
});
```

### Test Data

**ALWAYS** use realistic test data:

```typescript
// ‚úÖ Good
const user = { name: "John Doe", email: "john@example.com" };

// ‚ùå Bad
const user = { name: "test", email: "test" };
```

---

**Status:** ‚úÖ Active Rule  
**Priority:** CRITICAL  
**Date Created:** TODO:DATE_CONFIRMATION
