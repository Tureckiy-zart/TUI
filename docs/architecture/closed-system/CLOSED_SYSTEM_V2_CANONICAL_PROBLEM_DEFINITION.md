# Closed System v2 — Canonical Problem Definition

**Package:** `@tenerife.music/ui`  
**Layer:** Foundation / Architecture / Governance  
**Phase:** A — Problem Definition  
**Status:** Canonical draft (design-only)  
**Scope constraint:** No solutions, no APIs, no types, no implementation

---

## Purpose

Зафиксировать каноничное описание архитектурной проблемы, которую решает Closed System v2, без проектирования решений. Документ предназначен как единственный вход для Phase B (Architecture Design).

---

## Context Snapshot

Проект находится в стадии **DESIGN / GOVERNANCE**. Runtime-код не изменяется. Все design-артефакты считаются незафиксированными до утверждения этого документа.

---

## Canonical Problem Statement

Closed System v1 формально стремится ограничить произвольные изменения UI-слоя, но в текущем виде не обеспечивает достаточной архитектурной замкнутости. В результате система допускает множественные классы нарушений, которые размывают контракт компонентов, создают неоднозначность рендера и порождают agent-confusion (ошибки интерпретации и действия со стороны людей и AI). Проблема носит **системный** характер: это не набор багов, а отсутствие достаточного уровня формальной замкнутости и явных границ ответственности.

---

## Current Model (Closed System v1) and Its Limits

**Описание модели v1 (фактическое состояние):**
- Система стремится к закрытой архитектуре: компоненты и токены должны ограничивать способы выражения UI.
- Внутренние и внешние контракты описаны неравномерно и не всегда единообразно фиксируются.
- Политики и ограничения существуют, но границы их применимости неоднозначны.

**Ограничения модели v1:**
- Недостаточная формализация допустимых путей изменения UI.
- Наличие неявных или неполных контрактов, приводящих к дрейфу интерфейсов.
- Несогласованность между документацией, практикой и ожидаемым поведением.

---

## Classes of Violations (Closed-System Breaches)

### 1) Raw Utilities
Использование низкоуровневых утилит или стилей, обходящих формальные контракты компонентов и токенов. Нарушение проявляется как прямое влияние на визуальный или поведенческий результат без согласованного слоя абстракции.

### 2) Prop Leakage
Передача или проброс пропсов, которые позволяют обходить ограничения системы. Проблема включает неограниченные HTML-атрибуты или скрытые каналы влияния на рендер.

### 3) Polymorphism Drift
Сдвиг поведения компонентов из-за расширения полиморфизма (например, через разнообразие контейнеров/элементов), который нарушает исходные предположения о структуре и семантике.

### 4) Rendering Ambiguity
Ситуации, в которых один и тот же intent может выражаться множеством путей с разными визуальными или поведенческими результатами. Это нарушает детерминированность системы.

### 5) Agent-Confusion
Ошибки и неопределенность в интерпретации архитектурных правил людьми и AI. Возникает, когда документация, контракты и практики расходятся, создавая недостоверные сигналы о допустимых действиях.

---

## Sources of Errors

### Documentation Ambiguity
Документация допускает множественные трактовки либо не фиксирует границы ответственности.

### Incomplete Contracts
Контракты компонентов и слоев описаны частично или нерегулярно, что делает ограничения необязательными или обходными.

### Implicit Escape Hatches
Существуют неявные или исторически сложившиеся способы обхода правил, которые не зафиксированы как исключения и не контролируются.

---

## Architectural Risks If Unresolved

- Эрозия архитектурных контрактов и дрейф системы в сторону открытой модели.
- Рост числа исключений и локальных компромиссов, увеличивающих стоимость изменений.
- Усиление агентного риска: люди и AI принимают неверные решения из-за противоречивых сигналов.
- Снижение предсказуемости визуального и поведенческого результата.
- Потеря воспроизводимости UI-решений и сложности в governance-цикле.

---

## Responsibility Boundaries of `@tenerife.music/ui`

### В зоне ответственности библиотеки
- Определение и поддержание архитектурных контрактов компонентов, токенов и композиционных слоев.
- Формальная фиксация допустимых способов выражения UI в рамках библиотеки.
- Обеспечение предсказуемости и детерминированности поведения компонентов.

### Вне зоны ответственности библиотеки
- Проектирование и реализация продуктовой логики или бизнес-слоя.
- Решение конкретных продуктовых UX-задач вне контрактов библиотеки.
- Любые runtime-реализации, новые API, типы или enforcement-изменения в рамках данного этапа.

---

## Non-Goals and Explicit Prohibitions (Phase A)

- **No solutions:** не предлагать каналы, API, механизмы enforcement или типовые решения.
- **No implementation:** не вносить изменения в runtime-код или tooling.
- **No refactoring:** не изменять существующие компоненты или конфигурации.
- **No token/type system:** не проектировать типы, правила или токеновые схемы.

---

## Exit Criteria for Phase A

- Проблема зафиксирована как системная, не как набор багов.
- Классы нарушений Closed System v1 описаны и классифицированы.
- Agent-confusion признан архитектурным риском.
- Границы ответственности библиотеки определены и зафиксированы.
- Документ может быть единственным входом для Phase B (Architecture Design).

