#!/usr/bin/env tsx

/**
 * Extension Component Generator
 *
 * ============================================================================
 * –ù–ê–ó–ù–ê–ß–ï–ù–ò–ï
 * ============================================================================
 *
 * –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä–∫–∞—Å–∞ (scaffold) –¥–ª—è –Ω–æ–≤—ã—Ö Extension
 * –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤ –ø—Ä–æ–µ–∫—Ç–µ Tenerife UI. –û–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç
 * –ø—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º.
 *
 * ============================================================================
 * –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ô –ö–û–ù–¢–ï–ö–°–¢
 * ============================================================================
 *
 * –ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—Å–ª–æ–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É:
 *
 * 1. FOUNDATION Layer (src/FOUNDATION/) - –ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù, –ù–ï–ò–ó–ú–ï–ù–Ø–ï–ú
 *    - –ë–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã: Button, Link, Text, Input, Modal, Tabs, Select
 *    - –û–¥–∏–Ω –∫–∞–Ω–æ–Ω–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—é
 *    - –ù–µ–ª—å–∑—è –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å
 *    - –î–µ–ª–µ–≥–∏—Ä—É—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ Radix UI
 *
 * 2. EXTENSION Layer (src/COMPOSITION/) - –†–ê–°–®–ò–†–Ø–ï–ú–´–ô –°–õ–û–ô
 *    - –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–º–ø–æ–∑–∏—Ä—É—é—Ç Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
 *    - –†–µ–∞–ª–∏–∑—É—é—Ç —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
 *    - –ò—Å–ø–æ–ª—å–∑—É—é—Ç –¢–û–õ–¨–ö–û —Ç–æ–∫–µ–Ω—ã (–±–µ–∑ raw –∑–Ω–∞—á–µ–Ω–∏–π)
 *    - –°–ª–µ–¥—É—é—Ç Extension Authority Contract
 *
 * –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ EXTENSION —Å–ª–æ–µ.
 *
 * ============================================================================
 * –ß–¢–û –î–ï–õ–ê–ï–¢ –°–ö–†–ò–ü–¢
 * ============================================================================
 *
 * 1. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
 *    - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç PascalCase —Ñ–æ—Ä–º–∞—Ç
 *    - –ó–∞–ø—Ä–µ—â–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
 *    - –ó–∞–ø—Ä–µ—â–∞–µ—Ç –≤–∞—Ä–∏–∞—Ü–∏–∏ —Ç–∏–ø–∞ "SimpleButton", "ButtonV2"
 *
 * 2. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏ –ø—É—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è:
 *    - primitive/control/utility ‚Üí src/COMPOSITION/controls/
 *    - layout ‚Üí src/COMPOSITION/layout/
 *    - composite ‚Üí src/COMPOSITION/overlays/ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
 *
 * 3. –°–æ–∑–¥–∞–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤:
 *    - ComponentName.tsx - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å TODO –∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏
 *    - ComponentName.stories.tsx - Storybook –∏—Å—Ç–æ—Ä–∏–∏
 *    - ComponentName.test.tsx - —Ç–µ—Å—Ç—ã
 *    - ComponentName.index.ts - —ç–∫—Å–ø–æ—Ä—Ç—ã
 *
 * 4. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —à–∞–±–ª–æ–Ω—ã –∏–∑ templates/:
 *    - –ó–∞–º–µ–Ω—è–µ—Ç –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã ({{ComponentName}}, {{kebabName}}, etc.)
 *    - –î–æ–±–∞–≤–ª—è–µ—Ç compliance notes –∏ –ø—Ä–∏–º–µ—Ä—ã
 *
 * ============================================================================
 * –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï
 * ============================================================================
 *
 * –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
 *   pnpm run component:generate -- ConfirmDialog
 *
 * –° —É–∫–∞–∑–∞–Ω–∏–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏:
 *   pnpm run component:generate -- HeroSection --category layout
 *
 * –° –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø—É—Ç–µ–º:
 *   pnpm run component:generate -- CustomCard --category composite --output src/custom
 *
 * –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫:
 *   tsx scripts/generate-extension-component.ts MyComponent --category control
 *
 * ============================================================================
 * –í–ê–ñ–ù–´–ï –î–ï–¢–ê–õ–ò
 * ============================================================================
 *
 * - –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å '--' –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ pnpm run (pnpm –ø–µ—Ä–µ–¥–∞–µ—Ç
 *   –∞—Ä–≥—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ --, —á—Ç–æ–±—ã –æ—Ç–ª–∏—á–∏—Ç—å –∏—Ö –æ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Å–∞–º–æ–≥–æ pnpm)
 *
 * - –°–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç—Ä–æ–≥–∏–π –ø–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –æ–ø—Ü–∏–π
 *
 * - –í—Å–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å–æ–¥–µ—Ä–∂–∞—Ç TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
 *
 * - –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
 *
 * ============================================================================
 */

import { existsSync, mkdirSync, readFileSync, writeFileSync } from "fs";
import { join, resolve } from "path";
import { fileURLToPath } from "url";

/**
 * ============================================================================
 * –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
 * ============================================================================
 */

/**
 * –°–ø–∏—Å–æ–∫ Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ù–ï–õ–¨–ó–Ø –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å.
 *
 * Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ src/FOUNDATION/ –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã.
 * Extension –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö —á–µ—Ä–µ–∑ –∫–æ–º–ø–æ–∑–∏—Ü–∏—é, –∞ –Ω–µ
 * —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ–ø–∏–∏ –∏–ª–∏ –≤–∞—Ä–∏–∞—Ü–∏–∏.
 *
 * –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ
 * –Ω–æ–≤—ã–π Extension –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å –æ–ø–∏—Å–∞—Ç–µ–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, "ConfirmDialog"
 * –≤–º–µ—Å—Ç–æ "ModalV2" –∏–ª–∏ "SimpleModal").
 */
const FOUNDATION_COMPONENTS = ["Modal", "Tabs", "Select", "ContextMenu", "Toast", "Button", "Link"];

/**
 * –í–∞–ª–∏–¥–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ Extension –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.
 *
 * –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç —Ç–∏–ø –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏ –µ–≥–æ –º–µ—Å—Ç–æ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ:
 * - primitive: –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–º–∏—Ç–∏–≤—ã (–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–µ–¥–∫–æ, –æ–±—ã—á–Ω–æ –∫–æ–º–ø–æ–∑–∏—Ä—É—é—Ç—Å—è)
 * - control: –≠–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–∫–Ω–æ–ø–∫–∏, –∏–Ω–ø—É—Ç—ã, —Å–µ–ª–µ–∫—Ç—ã)
 * - layout: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏ (Stack, Grid, Container, Card)
 * - composite: –°–æ—Å—Ç–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–º–æ–¥–∞–ª–∫–∏, –¥–∏–∞–ª–æ–≥–∏, —Ç–æ—Å—Ç—ã, –æ–≤–µ—Ä–ª–µ–∏)
 * - utility: –£—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ, —Ö–µ–ª–ø–µ—Ä—ã)
 */
const VALID_CATEGORIES = ["primitive", "control", "layout", "composite", "utility"] as const;

type Category = (typeof VALID_CATEGORIES)[number];

/**
 * –ú–∞–ø–ø–∏–Ω–≥ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –≤ src/COMPOSITION/.
 *
 * –≠—Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –≥–¥–µ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
 * - primitive/control/utility ‚Üí controls/ (–æ–±—â–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
 * - layout ‚Üí layout/ (–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–æ–º–ø–æ–Ω–æ–≤–∫–∏)
 * - composite ‚Üí overlays/ (—Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –æ–≤–µ—Ä–ª–µ–∏, –º–æ–¥–∞–ª–∫–∏)
 *
 * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è "composite" (overlays).
 */
const CATEGORY_DIRS: Record<Category, string> = {
  primitive: "controls",
  control: "controls",
  layout: "layout",
  composite: "overlays",
  utility: "controls",
};

/**
 * –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
 *
 * –°–æ–¥–µ—Ä–∂–∏—Ç –≤—Å—é –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤:
 * - name: –ò—Å—Ö–æ–¥–Ω–æ–µ –∏–º—è –≤ PascalCase (–Ω–∞–ø—Ä–∏–º–µ—Ä, "ConfirmDialog")
 * - category: –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * - pascalName: –ò–º—è –≤ PascalCase (–æ–±—ã—á–Ω–æ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å name)
 * - kebabName: –ò–º—è –≤ kebab-case (–Ω–∞–ø—Ä–∏–º–µ—Ä, "confirm-dialog")
 * - dirPath: –ü–æ–ª–Ω—ã–π –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 */
interface ComponentConfig {
  name: string;
  category: Category;
  pascalName: string;
  kebabName: string;
  dirPath: string;
}

/**
 * ============================================================================
 * –í–ê–õ–ò–î–ê–¶–ò–Ø –ò–ú–ï–ù–ò –ö–û–ú–ü–û–ù–ï–ù–¢–ê
 * ============================================================================
 */

/**
 * –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ —Å–æ–≥–ª–∞—Å–Ω–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º.
 *
 * –ü—Ä–∞–≤–∏–ª–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
 * 1. –ù–ï –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º
 *    ‚ùå "Button", "Modal", "Tabs"
 *    ‚úÖ "ConfirmDialog", "NotificationCenter"
 *
 * 2. –ù–ï –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∞—Ä–∏–∞—Ü–∏–µ–π Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 *    ‚ùå "SimpleButton", "ButtonV2", "CustomModal", "OldTabs"
 *    ‚úÖ "ActionButton", "DialogVariant", "TabGroup" (–µ—Å–ª–∏ —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω–æ–≤—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç)
 *
 * 3. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ PascalCase
 *    ‚ùå "confirmDialog", "confirm-dialog", "_ConfirmDialog"
 *    ‚úÖ "ConfirmDialog", "NotificationCenter", "UserProfileCard"
 *
 * @param name - –ò–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
 * @throws Error –µ—Å–ª–∏ –∏–º—è –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞–º
 */
function validateComponentName(name: string): void {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞: –∏–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º
  if (FOUNDATION_COMPONENTS.includes(name)) {
    throw new Error(
      `‚ùå Component name "${name}" is a Foundation component. Use a descriptive, intent-based name instead.`,
    );
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞: –∏–º—è –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∞—Ä–∏–∞—Ü–∏–µ–π Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  // –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ "SimpleButton", "ButtonV2" –∏ —Ç.–¥.
  const foundationVariations = FOUNDATION_COMPONENTS.map((fc) => [
    `Simple${fc}`,
    `Basic${fc}`,
    `${fc}V2`,
    `Custom${fc}`,
    `Old${fc}`,
    `Legacy${fc}`,
  ]).flat();

  if (foundationVariations.includes(name)) {
    throw new Error(
      `‚ùå Component name "${name}" uses a Foundation component name. Use a descriptive, intent-based name instead.`,
    );
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞: –∏–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ PascalCase (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –∑–∞–≥–ª–∞–≤–Ω–æ–π, —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã –∏ —Ü–∏—Ñ—Ä—ã)
  if (!/^[A-Z][a-zA-Z0-9]*$/.test(name)) {
    throw new Error(
      `‚ùå Component name "${name}" must be in PascalCase (e.g., "ConfirmDialog", "NotificationCenter")`,
    );
  }
}

/**
 * ============================================================================
 * –ü–ê–†–°–ò–ù–ì –ê–†–ì–£–ú–ï–ù–¢–û–í –ö–û–ú–ê–ù–î–ù–û–ô –°–¢–†–û–ö–ò
 * ============================================================================
 */

/**
 * –ü–∞—Ä—Å–∏—Ç –∏ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏.
 *
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–≤–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –∑–∞–ø—É—Å–∫–∞:
 * 1. –ß–µ—Ä–µ–∑ pnpm run: pnpm run component:generate -- ComponentName --category layout
 *    (pnpm –ø–µ—Ä–µ–¥–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã —á–µ—Ä–µ–∑ '--' —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å)
 *
 * 2. –ü—Ä—è–º–æ–π –∑–∞–ø—É—Å–∫: tsx scripts/generate-extension-component.ts ComponentName --category layout
 *
 * –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞:
 * - –†–∞–∑–¥–µ–ª—è–µ—Ç –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã (–∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞) –∏ –æ–ø—Ü–∏–∏ (--category, --output)
 * - –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –æ–ø—Ü–∏–π
 * - –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ—Ç –æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ–ø—Ü–∏—è—Ö
 * - –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–Ω—è—Ç–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
 *
 * @returns –û–±—ä–µ–∫—Ç —Å —Ä–∞—Å–ø–∞—Ä—Å–µ–Ω–Ω—ã–º–∏ –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏
 * @throws Error –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö
 */
function parseArgs(): {
  componentName: string;
  category: Category;
  output?: string;
} {
  // –ü–æ–ª—É—á–∞–µ–º –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ (–∏—Å–∫–ª—é—á–∞—è node/tsx –∏ –ø—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É)
  let args = process.argv.slice(2);

  /**
   * –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è '--' –¥–ª—è pnpm/npm.
   *
   * –ö–æ–≥–¥–∞ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ pnpm run component:generate -- ComponentName,
   * pnpm –ø–µ—Ä–µ–¥–∞–µ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ '--', —á—Ç–æ–±—ã –æ—Ç–ª–∏—á–∏—Ç—å –∏—Ö –æ—Ç –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Å–∞–º–æ–≥–æ pnpm.
   * –ü–æ—ç—Ç–æ–º—É –ø–µ—Ä–≤—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å '--', –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å.
   *
   * –ü—Ä–∏–º–µ—Ä—ã:
   * - pnpm run component:generate -- TestComponent
   *   ‚Üí process.argv = [node, script, '--', 'TestComponent']
   *   ‚Üí args –ø–æ—Å–ª–µ slice(2) = ['--', 'TestComponent']
   *   ‚Üí –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ = ['TestComponent']
   *
   * - tsx script.ts TestComponent
   *   ‚Üí process.argv = [node, script, 'TestComponent']
   *   ‚Üí args –ø–æ—Å–ª–µ slice(2) = ['TestComponent']
   *   ‚Üí '--' –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
   */
  if (args.length > 0 && args[0] === "--" && args.length > 1) {
    args = args.slice(1);
  }

  if (args.length === 0) {
    console.error("‚ùå Component name is required");
    console.log("\nUsage:");
    console.log("  pnpm run component:generate -- <ComponentName> [options]");
    console.log("  tsx scripts/generate-extension-component.ts <ComponentName> [options]");
    console.log("\nOptions:");
    console.log(
      "  --category <category>  Component category (primitive|control|layout|composite|utility)",
    );
    console.log("  --output <path>         Output directory");
    console.log("\nExample:");
    console.log("  pnpm run component:generate -- MyComponent --category composite");
    process.exit(1);
  }

  /**
   * –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –æ–ø—Ü–∏–π.
   *
   * –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã - —ç—Ç–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ã –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ '--' (–∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞).
   * –û–ø—Ü–∏–∏ - —ç—Ç–æ –∞—Ä–≥—É–º–µ–Ω—Ç—ã —Å –ø—Ä–µ—Ñ–∏–∫—Å–æ–º '--' –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è (--category layout).
   */
  const positionalArgs: string[] = [];
  const options: Record<string, string> = {};

  /**
   * –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤: —Å–±–æ—Ä –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏ –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ.
   *
   * –ê–ª–≥–æ—Ä–∏—Ç–º:
   * 1. –ï—Å–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '--' ‚Üí —ç—Ç–æ –æ–ø—Ü–∏—è
   * 2. –°–ª–µ–¥—É—é—â–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç (–µ—Å–ª–∏ –Ω–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '--') ‚Üí –∑–Ω–∞—á–µ–Ω–∏–µ –æ–ø—Ü–∏–∏
   * 3. –ò–Ω–∞—á–µ ‚Üí –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç (–∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
   */
  for (let i = 0; i < args.length; i++) {
    const arg = args[i];

    // –ü—Ä–æ–ø—É—Å–∫ standalone '--' (–Ω–µ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –ø–æ—Å–ª–µ –Ω–∞—á–∞–ª—å–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, –Ω–æ –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    if (arg === "--" && i === 0) {
      continue;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞: —ç—Ç–æ –æ–ø—Ü–∏—è (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å '--')?
    if (arg.startsWith("--")) {
      const optionName = arg.slice(2); // –£–±–∏—Ä–∞–µ–º '--'

      // –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å—Ç—å –ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ–ø—Ü–∏–∏ (—Å–ª–µ–¥—É—é—â–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π)?
      if (i + 1 < args.length && !args[i + 1]?.startsWith("--")) {
        options[optionName] = args[i + 1];
        i++; // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–ª–µ–¥—É—é—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏
      } else {
        // –û–ø—Ü–∏—è –±–µ–∑ –∑–Ω–∞—á–µ–Ω–∏—è - –æ—à–∏–±–∫–∞ –¥–ª—è –Ω–∞—à–µ–≥–æ —Å–ª—É—á–∞—è
        throw new Error(
          `‚ùå Option --${optionName} requires a value. Example: --${optionName} <value>`,
        );
      }
    } else {
      // –ü–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç (–∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
      positionalArgs.push(arg);
    }
  }

  /**
   * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –∏–∑ –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤.
   *
   * –ü–µ—Ä–≤—ã–π –ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–π –∞—Ä–≥—É–º–µ–Ω—Ç - —ç—Ç–æ –≤—Å–µ–≥–¥–∞ –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
   */
  if (positionalArgs.length === 0) {
    throw new Error(
      "‚ùå Component name is required as the first argument.\n" +
        "Usage: pnpm run component:generate -- <ComponentName> [options]",
    );
  }

  const componentName = positionalArgs[0];

  /**
   * –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–ø—Ü–∏–µ–π.
   *
   * –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏, –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å '--' —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å:
   * pnpm run component:generate ComponentName (–±–µ–∑ '--')
   * ‚Üí pnpm –º–æ–∂–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å ComponentName –∫–∞–∫ –æ–ø—Ü–∏—é
   */
  if (componentName.startsWith("--")) {
    throw new Error(
      `‚ùå Component name cannot start with "--". Did you forget to use "--" separator?\n` +
        `Usage: pnpm run component:generate -- <ComponentName>`,
    );
  }

  /**
   * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏–∑ –æ–ø—Ü–∏–π –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
   *
   * –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è "composite" (overlays), —Ç–∞–∫ –∫–∞–∫ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ
   * Extension –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ - —ç—Ç–æ —Å–æ—Å—Ç–∞–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–¥–∏–∞–ª–æ–≥–∏, –º–æ–¥–∞–ª–∫–∏, —Ç–æ—Å—Ç—ã).
   */
  const category = (options.category || "composite") as Category;

  // –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
  if (!VALID_CATEGORIES.includes(category)) {
    throw new Error(
      `‚ùå Invalid category "${category}". Must be one of: ${VALID_CATEGORIES.join(", ")}`,
    );
  }

  /**
   * –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—É—Ç–∏ –≤—ã–≤–æ–¥–∞ –∏–∑ –æ–ø—Ü–∏–π (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ).
   *
   * –ï—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø—É—Ç—å:
   * src/COMPOSITION/{categoryDir}/{componentName}
   */
  const output = options.output;

  /**
   * –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ–ø—Ü–∏—è—Ö.
   *
   * –≠—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–∞–º–µ—Ç–∏—Ç—å –æ–ø–µ—á–∞—Ç–∫–∏ –≤ –æ–ø—Ü–∏—è—Ö.
   * –ù–∞–ø—Ä–∏–º–µ—Ä, --categroy –≤–º–µ—Å—Ç–æ --category.
   */
  const knownOptions = ["category", "output"];
  const unknownOptions = Object.keys(options).filter((key) => !knownOptions.includes(key));
  if (unknownOptions.length > 0) {
    console.warn(
      `‚ö†Ô∏è  Unknown options: ${unknownOptions.map((opt) => `--${opt}`).join(", ")}. Ignoring.`,
    );
  }

  return { componentName, category, output };
}

/**
 * ============================================================================
 * –£–¢–ò–õ–ò–¢–´ –î–õ–Ø –ì–ï–ù–ï–†–ê–¶–ò–ò
 * ============================================================================
 */

/**
 * –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç PascalCase –≤ kebab-case.
 *
 * –ü—Ä–∏–º–µ—Ä—ã:
 * - "ConfirmDialog" ‚Üí "confirm-dialog"
 * - "NotificationCenter" ‚Üí "notification-center"
 * - "UserProfileCard" ‚Üí "user-profile-card"
 *
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:
 * - –ò–º–µ–Ω —Ñ–∞–π–ª–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
 * - CSS –∫–ª–∞—Å—Å–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
 * - URL –ø—É—Ç–µ–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
 *
 * @param str - –°—Ç—Ä–æ–∫–∞ –≤ PascalCase
 * @returns –°—Ç—Ä–æ–∫–∞ –≤ kebab-case
 */
function toKebabCase(str: string): string {
  return str.replace(/([a-z])([A-Z])/g, "$1-$2").toLowerCase();
}

/**
 * –ó–∞–≥—Ä—É–∂–∞–µ—Ç —à–∞–±–ª–æ–Ω —Ñ–∞–π–ª–∞ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ templates/.
 *
 * –®–∞–±–ª–æ–Ω—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ templates/ –∏ –∏–º–µ—é—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ .template.
 * –ù–∞–ø—Ä–∏–º–µ—Ä: templates/extension-component.template
 *
 * @param templateName - –ò–º—è —à–∞–±–ª–æ–Ω–∞ –±–µ–∑ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
 * @returns –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞
 * @throws Error –µ—Å–ª–∏ —à–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω
 */
function loadTemplate(templateName: string): string {
  const templatePath = join(process.cwd(), "templates", `${templateName}.template`);

  if (!existsSync(templatePath)) {
    throw new Error(`‚ùå Template not found: ${templatePath}`);
  }

  return readFileSync(templatePath, "utf-8");
}

/**
 * –ó–∞–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω–∞ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
 *
 * –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
 * - {{ComponentName}} - –ò–º—è –≤ PascalCase (–Ω–∞–ø—Ä–∏–º–µ—Ä, "ConfirmDialog")
 * - {{componentName}} - –ò–º—è –≤ camelCase (–Ω–∞–ø—Ä–∏–º–µ—Ä, "confirmDialog")
 * - {{kebabName}} - –ò–º—è –≤ kebab-case (–Ω–∞–ø—Ä–∏–º–µ—Ä, "confirm-dialog")
 * - {{pascalName}} - –ò–º—è –≤ PascalCase (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ ComponentName)
 * - {{category}} - –ö–∞—Ç–µ–≥–æ—Ä–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "composite")
 *
 * @param template - –°–æ–¥–µ—Ä–∂–∏–º–æ–µ —à–∞–±–ª–æ–Ω–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
 * @param config - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * @returns –®–∞–±–ª–æ–Ω —Å –∑–∞–º–µ–Ω–µ–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏
 */
function replaceTemplate(template: string, config: ComponentConfig): string {
  return template
    .replace(/\{\{ComponentName\}\}/g, config.name)
    .replace(/\{\{componentName\}\}/g, config.name.charAt(0).toLowerCase() + config.name.slice(1))
    .replace(/\{\{kebabName\}\}/g, config.kebabName)
    .replace(/\{\{category\}\}/g, config.category)
    .replace(/\{\{pascalName\}\}/g, config.pascalName);
}

/**
 * ============================================================================
 * –ì–ï–ù–ï–†–ê–¶–ò–Ø –§–ê–ô–õ–û–í –ö–û–ú–ü–û–ù–ï–ù–¢–ê
 * ============================================================================
 */

/**
 * –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ —Ñ–∞–π–ª—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ Extension –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
 *
 * –°–æ–∑–¥–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
 *   {dirPath}/
 *     ComponentName.tsx          - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
 *     ComponentName.stories.tsx - Storybook –∏—Å—Ç–æ—Ä–∏–∏
 *     ComponentName.test.tsx    - –¢–µ—Å—Ç—ã
 *     ComponentName.index.ts    - –≠–∫—Å–ø–æ—Ä—Ç—ã
 *
 * –ü—Ä–æ—Ü–µ—Å—Å:
 * 1. –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)
 * 2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –µ—â–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
 * 3. –ó–∞–≥—Ä—É–∂–∞–µ—Ç —à–∞–±–ª–æ–Ω—ã –∏–∑ templates/
 * 4. –ó–∞–º–µ–Ω—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ —à–∞–±–ª–æ–Ω–∞—Ö
 * 5. –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã –Ω–∞ –¥–∏—Å–∫
 *
 * @param config - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * @throws Error –µ—Å–ª–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
 */
async function generateComponent(config: ComponentConfig): Promise<void> {
  const { dirPath, name } = config;

  // –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
  if (!existsSync(dirPath)) {
    mkdirSync(dirPath, { recursive: true });
  }

  /**
   * –ü—Ä–æ–≤–µ—Ä–∫–∞: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –Ω–µ –¥–æ–ª–∂–µ–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å.
   *
   * –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—É—é –ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
   * –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, —É–¥–∞–ª–∏—Ç–µ –µ–≥–æ –≤—Ä—É—á–Ω—É—é.
   */
  const componentFile = join(dirPath, `${name}.tsx`);
  if (existsSync(componentFile)) {
    throw new Error(`‚ùå Component already exists: ${componentFile}`);
  }

  /**
   * –°–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.
   *
   * –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–µ—Ç—Å—è –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ —à–∞–±–ª–æ–Ω–∞ –≤ templates/.
   * –ï—Å–ª–∏ —à–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, —Ñ–∞–π–ª –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ–º.
   */
  const templates = [
    { template: "extension-component", ext: "tsx" },
    { template: "extension-component.stories", ext: "stories.tsx" },
    { template: "extension-component.test", ext: "test.tsx" },
    { template: "extension-component.index", ext: "index.ts" },
  ];

  /**
   * –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ —à–∞–±–ª–æ–Ω–æ–≤.
   *
   * –î–ª—è –∫–∞–∂–¥–æ–≥–æ —à–∞–±–ª–æ–Ω–∞:
   * 1. –ó–∞–≥—Ä—É–∂–∞–µ–º —à–∞–±–ª–æ–Ω
   * 2. –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ({{ComponentName}}, {{kebabName}}, etc.)
   * 3. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ñ–∞–π–ª –Ω–∞ –¥–∏—Å–∫
   */
  let createdFiles = 0;
  let skippedFiles = 0;

  for (const { template, ext } of templates) {
    try {
      const templateContent = loadTemplate(template);
      const content = replaceTemplate(templateContent, config);
      const filePath = join(dirPath, `${name}.${ext}`);

      writeFileSync(filePath, content, "utf-8");
      console.log(`   ‚úì –°–æ–∑–¥–∞–Ω: ${name}.${ext}`);
      createdFiles++;
    } catch (error) {
      // –ï—Å–ª–∏ —à–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –µ–≥–æ (–º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω –ø–æ–∑–∂–µ)
      if (error instanceof Error && error.message.includes("Template not found")) {
        console.log(`   ‚ö†Ô∏è  –®–∞–±–ª–æ–Ω –Ω–µ –Ω–∞–π–¥–µ–Ω: ${template}.template (–±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω–æ)`);
        skippedFiles++;
      } else {
        throw error;
      }
    }
  }

  console.log(`\n   üìä –°–æ–∑–¥–∞–Ω–æ —Ñ–∞–π–ª–æ–≤: ${createdFiles}`);
  if (skippedFiles > 0) {
    console.log(`   ‚ö†Ô∏è  –ü—Ä–æ–ø—É—â–µ–Ω–æ —Ñ–∞–π–ª–æ–≤: ${skippedFiles}`);
  }

  // –í—ã–≤–æ–¥ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–∑–¥–∞–Ω–Ω–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ –∏ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–∞—Ö
  console.log("\nüìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:");
  console.log("   1. –ü—Ä–æ—Å–º–æ—Ç—Ä–∏—Ç–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã");
  console.log("   2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –ª–æ–≥–∏–∫—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞");
  console.log("   3. –î–æ–±–∞–≤—å—Ç–µ Storybook –∏—Å—Ç–æ—Ä–∏–∏");
  console.log("   4. –ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã");
  console.log("   5. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –∏–∑ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ index.ts");
  console.log("   6. –°–ª–µ–¥—É–π—Ç–µ Extension Component Creation Checklist");
}

/**
 * ============================================================================
 * –ì–õ–ê–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø
 * ============================================================================
 */

/**
 * –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å–∫—Ä–∏–ø—Ç–∞.
 *
 * –í—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
 * 1. –ü–∞—Ä—Å–∏—Ç –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
 * 2. –í–∞–ª–∏–¥–∏—Ä—É–µ—Ç –∏–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
 * 3. –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø—É—Ç—å —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
 * 4. –°–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
 * 5. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ–∞–π–ª—ã
 *
 * @throws Error –ø—Ä–∏ –ª—é–±–æ–π –æ—à–∏–±–∫–µ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, etc.)
 */
async function main() {
  try {
    console.log("=".repeat(70));
    console.log("üîß EXTENSION COMPONENT GENERATOR");
    console.log("=".repeat(70));
    console.log("\nüìã –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:");
    console.log("   –°–æ–∑–¥–∞–µ—Ç –∫–∞—Ä–∫–∞—Å (scaffold) –¥–ª—è –Ω–æ–≤–æ–≥–æ Extension –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.");
    console.log("   –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ñ–∞–π–ª–æ–≤, –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è");
    console.log("   –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º.\n");

    // –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
    console.log("üîç –ü–∞—Ä—Å–∏–Ω–≥ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤...");
    const { componentName, category, output } = parseArgs();
    console.log(`   ‚úì –ò–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞: ${componentName}`);
    console.log(`   ‚úì –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category}`);
    if (output) {
      console.log(`   ‚úì –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—É—Ç—å: ${output}`);
    }

    // –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ (PascalCase, –Ω–µ Foundation, –Ω–µ –≤–∞—Ä–∏–∞—Ü–∏—è)
    console.log("\n‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –∏–º–µ–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞...");
    validateComponentName(componentName);
    console.log(`   ‚úì –ò–º—è –≤–∞–ª–∏–¥–Ω–æ (PascalCase)`);
    console.log(`   ‚úì –ù–µ —è–≤–ª—è–µ—Ç—Å—è Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–º`);
    console.log(`   ‚úì –ù–µ —è–≤–ª—è–µ—Ç—Å—è –≤–∞—Ä–∏–∞—Ü–∏–µ–π Foundation –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞`);

    /**
     * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞.
     *
     * –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—É—Ç–∏:
     * - –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω --output: {output}/{categoryDir}/{componentName}
     * - –ò–Ω–∞—á–µ: src/COMPOSITION/{categoryDir}/{componentName}
     *
     * –ü—Ä–∏–º–µ—Ä—ã:
     * - category=composite ‚Üí src/COMPOSITION/overlays/ConfirmDialog
     * - category=layout ‚Üí src/COMPOSITION/layout/HeroSection
     * - category=control ‚Üí src/COMPOSITION/controls/ActionButton
     */
    const baseDir = output || join(process.cwd(), "src", "COMPOSITION");
    const categoryDir = CATEGORY_DIRS[category];
    const componentDir = join(baseDir, categoryDir, componentName);

    console.log("\nüìÅ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—É—Ç–∏ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è...");
    console.log(`   ‚úì –ë–∞–∑–æ–≤–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${baseDir}`);
    console.log(`   ‚úì –ö–∞—Ç–µ–≥–æ—Ä–∏—è ‚Üí –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: ${category} ‚Üí ${categoryDir}`);
    console.log(`   ‚úì –ü–æ–ª–Ω—ã–π –ø—É—Ç—å: ${componentDir}`);

    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    const config: ComponentConfig = {
      name: componentName,
      category,
      pascalName: componentName,
      kebabName: toKebabCase(componentName),
      dirPath: componentDir,
    };

    console.log("\nüîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞...");
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    await generateComponent(config);

    console.log("\n" + "=".repeat(70));
    console.log("‚úÖ –ö–û–ú–ü–û–ù–ï–ù–¢ –£–°–ü–ï–®–ù–û –°–û–ó–î–ê–ù");
    console.log("=".repeat(70));
    console.log(`\nüì¶ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç: ${componentName}`);
    console.log(`üìÇ –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: ${componentDir}`);
    console.log(`üè∑Ô∏è  –ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${category}`);
    console.log(`üî§ Kebab-case: ${config.kebabName}\n`);
  } catch (error) {
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
    console.log("\n" + "=".repeat(70));
    console.log("‚ùå –û–®–ò–ë–ö–ê –ü–†–ò –ì–ï–ù–ï–†–ê–¶–ò–ò");
    console.log("=".repeat(70));
    if (error instanceof Error) {
      console.error(`\n${error.message}\n`);
    } else {
      console.error("\n‚ùå Unexpected error:", error, "\n");
    }
    process.exit(1);
  }
}

/**
 * ============================================================================
 * –¢–û–ß–ö–ê –í–•–û–î–ê –°–ö–†–ò–ü–¢–ê
 * ============================================================================
 */

/**
 * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ —Å–∫—Ä–∏–ø—Ç –Ω–∞–ø—Ä—è–º—É—é –∏–ª–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ –º–æ–¥—É–ª—å.
 *
 * –í CommonJS —ç—Ç–æ –¥–µ–ª–∞–ª–æ—Å—å —á–µ—Ä–µ–∑ require.main === module.
 * –í ES –º–æ–¥—É–ª—è—Ö –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É process.argv[1] –∏ import.meta.url.
 *
 * –°–∫—Ä–∏–ø—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å main() —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∑–∞–ø—É—â–µ–Ω –Ω–∞–ø—Ä—è–º—É—é:
 * - tsx scripts/generate-extension-component.ts ComponentName
 * - pnpm run component:generate -- ComponentName
 *
 * –ù–æ –ù–ï –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å main() –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:
 * - import { generateComponent } from './generate-extension-component'
 */
const __filename = fileURLToPath(import.meta.url);
const scriptName = "generate-extension-component.ts";

/**
 * –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.
 *
 * process.argv[1] —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Ç—å –∫ —Å–∫—Ä–∏–ø—Ç—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑:
 * - tsx script.ts ‚Üí –ø—É—Ç—å –∫ script.ts
 * - node script.ts ‚Üí –ø—É—Ç—å –∫ script.ts
 * - pnpm run script ‚Üí –ø—É—Ç—å –∫ script.ts
 *
 * –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏:
 * - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ –≤ –ø—É—Ç–∏
 * - –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø—É—Ç–∏
 * - –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è
 * - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è –ø—É—Ç–∏
 * - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏ (–¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –ø—É—Ç–µ–π)
 */
const argv1 = process.argv[1] || "";

const isMainModule =
  argv1.includes(scriptName) ||
  argv1.endsWith(scriptName) ||
  argv1.includes("generate-extension-component") ||
  argv1 === __filename ||
  resolve(argv1) === resolve(__filename);

// –ó–∞–ø—É—Å–∫ main() —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é
if (isMainModule) {
  main();
}

/**
 * –≠–∫—Å–ø–æ—Ä—Ç —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –¥—Ä—É–≥–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö.
 *
 * –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤ –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ö,
 * –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏–ª–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
 */
export { generateComponent, validateComponentName, type ComponentConfig };
